openapi: 3.0.0
info:
  title: Grekko
  description: This is the backend for Grekko, a geoprocessing API
  contact:
    email: awesomealpineibex@gmail.com
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  version: 0.0.1
servers:
- url: https://virtserver.swaggerhub.com/Ddall/Grekko/1.0.0
  description: SwaggerHub API Auto Mocking
tags:
- name: geocoding
  description: Geocoding operations, they may evolve to query parameters in the future
- name: vehicle routing
  description: Operations involving vehicle routing and most efficient paths
paths:
  /geocoding/reverse:
    get:
      tags:
      - geocoding
      summary: Performs forward geocoding on a postcode
      description: |
        By providing a latitude and longitude, you will recieve a postcode.
      operationId: reverseGeocoding
      parameters:
      - name: latitude
        in: path
        description: the latitude of the coordinate
        required: true
        style: simple
        explode: false
        schema:
          type: number
      - name: longitude
        in: path
        description: the longitude of the coordinate
        required: true
        style: simple
        explode: false
        schema:
          type: number
      responses:
        "200":
          description: search results matching criteria
          content:
            text/plain:
              schema:
                type: string
                example: BS11AA
        "404":
          description: coordinates don't exist
  /geocoding/forward:
    get:
      tags:
      - geocoding
      summary: Performs forward geocoding on a postcode
      description: |
        By providing a valid postcode, you will recieve a latitude and longitude for it.
      operationId: forwardGeocoding
      parameters:
      - name: postcode
        in: path
        description: the postcode to convert
        required: true
        style: simple
        explode: false
        schema:
          type: string
      responses:
        "200":
          description: search results matching criteria
          content:
            text/plain:
              schema:
                type: string
                example: 51.509865,-0.118092
        "404":
          description: postcode doesn't exist
    post:
      tags:
      - admins
      summary: adds an inventory item
      description: Adds an item to the system
      operationId: addInventory
      requestBody:
        description: Inventory item to add
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InventoryItem'
      responses:
        "201":
          description: item created
        "400":
          description: invalid input, object invalid
        "409":
          description: an existing item already exists
  /vrp/simple:
    get:
      tags:
      - vehicle routing
      summary: Perform a simple vehicle routing problem with minimal constraints
      description: |
        This endpoint will allow you to pass simple query parameters of vehicles and jobs, this would then calculate the best solution in the most minimum time possible if all vehicles end at their start position.
      operationId: simpleProblem
      parameters:
      - name: coordinateVehicles
        in: query
        description: The list of vehicle coordinates that would be input to the problem
          matrix. This is required if postcodeVehicles were not supplied.
        required: false
        style: form
        explode: true
        schema:
          type: array
          items:
            type: string
            example: 51.509865,-0.118092;
      - name: coordinateJobs
        in: query
        description: The list of job coordinates that would be input to the problem
          matrix. This is required if postcodeJobs were not supplied.
        required: false
        style: form
        explode: true
        schema:
          type: array
          items:
            type: string
            example: 51.509865,-0.118092;
      - name: postcodeVehicles
        in: query
        description: The list of vehicle postcodes that would be input to the problem
          matrix. This is required if coordinateVehicles were not supplied.
        required: false
        style: form
        explode: true
        schema:
          type: array
          items:
            type: string
            example: BS11AA;
      - name: postcodeJobs
        in: query
        description: The list of job postcodes that would be input to the problem
          matrix. This is required if coordinateJobs were not supplied.
        required: false
        style: form
        explode: true
        schema:
          type: array
          items:
            type: string
            example: BS11AA;
      responses:
        "200":
          description: The route response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleSolution'
        "400":
          description: Bad input parameters
        "422":
          description: Input postcodes/coordinates could not be found
components:
  schemas:
    Solution:
      required:
      - statistics
      - tours
      - unassigned
      type: object
      properties:
        statistics:
          $ref: '#/components/schemas/Statistic'
        tours:
          type: array
          items:
            $ref: '#/components/schemas/Tour'
        unassigned:
          type: array
          items:
            $ref: '#/components/schemas/UnassignedJob'
        extras:
          $ref: '#/components/schemas/Extras'
    SimpleSolution:
      required:
      - tours
      - unassigned
      type: object
      properties:
        tours:
          type: array
          items:
            $ref: '#/components/schemas/Tour'
        unassigned:
          type: array
          items:
            $ref: '#/components/schemas/UnassignedJob'
    Statistic:
      required:
      - distance
      - driving
      - duration
      type: object
      properties:
        distance:
          type: number
          description: The overall distance travelled in miles
          example: 500
        duration:
          type: string
          description: The total duration in hours
          example: 1:30
        driving:
          type: string
          description: The total time spent driving
          example: 5:30
        serving:
          type: string
          description: The total time spent serving jobs
          example: 2:10
        waiting:
          type: string
          description: The total time spent waiting
          example: 5:30
    Tour:
      required:
      - shift_index
      - statistic
      - type_id
      - vehicle_id
      type: object
      properties:
        vehicle_id:
          type: string
          example: OXSAKS58473
        type_id:
          type: string
          example: TODO THIS ONE !!!!! ENUM expected
        shift_index:
          type: number
          example: 1
        stops:
          type: array
          items:
            $ref: '#/components/schemas/Stop'
        statistic:
          $ref: '#/components/schemas/Statistic'
    Stop:
      type: object
      properties:
        location:
          $ref: '#/components/schemas/Location'
        schedule:
          $ref: '#/components/schemas/Schedule'
        distance:
          type: number
          description: The distance travelled since the start job
          example: 5
        load:
          type: array
          items:
            type: number
            example: 5
        activities:
          type: array
          description: Activities performed during this stop
          items:
            type: number
            example: 5
    Location:
      type: object
      properties:
        arrival:
          type: string
          description: Arrival time specified in RFC3339 format
          example: "51.0"
        departure:
          type: string
          description: Departure time specified in RFC3339 format
          example: "0.03874"
    Schedule:
      type: object
      properties:
        lat:
          type: number
          description: The latitude of the location
          example: 51.0
        lng:
          type: number
          description: The longitude of the location
          example: 0.03874
    UnassignedJob:
      type: object
      properties:
        job_id:
          type: string
          example: OXXJ38347
        reasons:
          type: array
          items:
            $ref: '#/components/schemas/UnassignedJobReason'
    UnassignedJobReason:
      type: object
      properties:
        code:
          type: number
          example: 232
        description:
          type: string
          example: the job was unassigned because no address could be found for it
    Extras:
      type: object
      properties:
        performance:
          type: array
          items:
            $ref: '#/components/schemas/Iteration'
    Iteration:
      required:
      - cost
      - number
      - timestamp
      - tours
      - unassigned
      type: object
      properties:
        number:
          type: number
          example: 34
        cost:
          type: number
          example: 373.0
        tours:
          type: number
          example: 28
        unassigned:
          type: number
          example: 29
        timestamp:
          type: string
          format: date-time
          example: 2016-08-29T09:12:33.001Z
    InventoryItem:
      required:
      - id
      - manufacturer
      - name
      - releaseDate
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: d290f1ee-6c54-4b01-90e6-d701748f0851
        name:
          type: string
          example: Widget Adapter
        releaseDate:
          type: string
          format: date-time
          example: 2016-08-29T09:12:33.001Z
        manufacturer:
          $ref: '#/components/schemas/Manufacturer'
    Manufacturer:
      required:
      - name
      type: object
      properties:
        name:
          type: string
          example: ACME Corporation
        homePage:
          type: string
          format: url
          example: https://www.acme-corp.com
        phone:
          type: string
          example: 408-867-5309
